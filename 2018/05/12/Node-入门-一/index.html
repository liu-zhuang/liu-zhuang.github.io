<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      Node 入门(一) | MARVEL 
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="刘荘">
    
    

    <meta name="description" content="Module(模块)官方文档 在Nodejs的模块系统中，每一个文件都被视为独立的模块。 123const a = &amp;apos;a&amp;apos;;debugger;console.log(a); 比如以上这段代码，使用node --inspect-brk ./1-commonjs.js命令，在chrome中打开调试，可以看到以下内容：可以看到，在我们写的代码外面，被包了一层称之为模块包装器的函数。通">
<meta name="keywords" content="node.js">
<meta property="og:type" content="article">
<meta property="og:title" content="Node 入门(一) | MARVEL">
<meta property="og:url" content="http://liuz.top/2018/05/12/Node-入门-一/index.html">
<meta property="og:site_name" content="MARVEL">
<meta property="og:description" content="Module(模块)官方文档 在Nodejs的模块系统中，每一个文件都被视为独立的模块。 123const a = &amp;apos;a&amp;apos;;debugger;console.log(a); 比如以上这段代码，使用node --inspect-brk ./1-commonjs.js命令，在chrome中打开调试，可以看到以下内容：可以看到，在我们写的代码外面，被包了一层称之为模块包装器的函数。通">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://liuz.top/2018/05/12/Node-入门-一/commonjs.jpg">
<meta property="og:updated_time" content="2018-05-20T15:57:27.615Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Node 入门(一) | MARVEL">
<meta name="twitter:description" content="Module(模块)官方文档 在Nodejs的模块系统中，每一个文件都被视为独立的模块。 123const a = &amp;apos;a&amp;apos;;debugger;console.log(a); 比如以上这段代码，使用node --inspect-brk ./1-commonjs.js命令，在chrome中打开调试，可以看到以下内容：可以看到，在我们写的代码外面，被包了一层称之为模块包装器的函数。通">
<meta name="twitter:image" content="http://liuz.top/2018/05/12/Node-入门-一/commonjs.jpg">
    
    
    
      <link rel="icon" type="image/x-icon" href="/favicon.png">
    
    <link rel="stylesheet" href="/css/uno.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/archive.css">
    <link rel="stylesheet" href="/css/china-social-icon.css">

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">

  
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">MARVEL</a></h1>
        <hr class="panel-cover__divider" />

        
        <p class="panel-cover__description">
          大叔笔记
        </p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="http://liuz.top" title="" class="">主页</a></li>
              
                
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">博客</a></li>
              
                
                <li class="navigation__item"><a href="/about" title="" class="">关于</a></li>
              
                
                <li class="navigation__item"><a href="/archive" title="" class="">归档</a></li>
              

            </ul>
          </nav>

          <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->



<nav class="cover-navigation navigation--social">
  <ul class="navigation">

    
      <!-- Github -->
      <li class="navigation__item">
        <a href="https://github.com/nicky-lau" title="Huno on GitHub">
          <i class='icon icon-social-github'></i>
          <span class="label">GitHub</span>
        </a>
      </li>
    

    <!-- China social icon -->
    <!--
    
      <li class="navigation__item">
        <a href="" title="">
          <i class='icon cs-icon-douban'></i>
          <span class="label">Douban</span>
        </a>
      </li>

      <li class="navigation__item">
        <a href="" title="">
          <i class='icon cs-icon-weibo'></i>
          <span class="label">Weibo</span>
        </a>
      </li>

    -->



  </ul>
</nav>



        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">
    
    <h1 class="post-title">Node 入门(一)</h1>

    

    <div class="post-meta">
      <time datetime="2018-05-12" class="post-meta__date date">2018-05-12</time> 

      <span class="post-meta__tags tags">

          

          
             &#8226; 标签:
            <font class="tags">
              <a class="tags-link" href="/tags/node-js/">node.js</a>
            </font>
          

      </span>
    </div>
    
    

  </header>

  <section id="post-content" class="article-content post">
    <h1 id="Module-模块"><a href="#Module-模块" class="headerlink" title="Module(模块)"></a>Module(模块)</h1><p><a href="http://nodejs.cn/api/modules.html" target="_blank" rel="noopener">官方文档</a></p>
<p>在Nodejs的模块系统中，每一个文件都被视为独立的模块。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const a = &apos;a&apos;;</span><br><span class="line">debugger;</span><br><span class="line">console.log(a);</span><br></pre></td></tr></table></figure>
<p>比如以上这段代码，使用<code>node --inspect-brk ./1-commonjs.js</code>命令，在chrome中打开调试，可以看到以下内容：<br><img src="/2018/05/12/Node-入门-一/commonjs.jpg" alt="commonjs"><br>可以看到，在我们写的代码外面，被包了一层称之为<code>模块包装器</code>的函数。<br>通过这样做，Nodejs实现了以下几个作用:</p>
<ul>
<li>保持了局部作用域，不会污染全局变量</li>
<li>可以方便的提供模块到处功能</li>
</ul>
<h2 id="exports"><a href="#exports" class="headerlink" title="exports"></a>exports</h2><p>这个是其实是<code>module.exports</code>的简写，大部分场合可以认为这两者是一致的。但是要特别注意的是，以下写法是要特别注意的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">module.exports.test = 1; // right</span><br><span class="line">exports.test = 1;        // right</span><br><span class="line"></span><br><span class="line">module.exports = &#123;test: 1&#125;; // right</span><br><span class="line">exports = &#123;test:1&#125;;         // wrong 因为这样就改变了exports的引用关系，不再指向module.exports了</span><br></pre></td></tr></table></figure></p>
<p>如<a href="https://github.com/liu-zhuang/node-basic/blob/master/3-exports.js" target="_blank" rel="noopener">demo-exports</a>和<a href="https://github.com/liu-zhuang/node-basic/blob/master/3-exports-2.js" target="_blank" rel="noopener">demo-require</a>所示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const person = &#123;</span><br><span class="line">	name: &apos;lz&apos;,</span><br><span class="line">	age: 18</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = person; // &#123; name: &apos;lz&apos;, age: 18 &#125;</span><br><span class="line">// module.exports.person = person; // &#123; person: &#123; name: &apos;lz&apos;, age: 18 &#125;&#125;</span><br><span class="line">// exports.person = person;  // &#123; person: &#123; name: &apos;lz&apos;, age: 18 &#125;&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看出，如果直接使用<code>module.exports = person</code>在require时，是直接拿到<code>person</code>对象，如果使用<code>module.exports.person = person</code>，则在require时，如果不使用<code>const {person} = require(&#39;xxx&#39;)</code>到话，其实会在外面再包一层<code>{person: {name: &#39;lz&#39;, age: 18}}</code>,实际效果和<code>ES6</code>中模块的到处default有点像。</p>
<p>另外，如果在<code>module.exports</code>之后，再写一行<code>module.exports.worker = {type: &#39;worker&#39;}</code>,就会把这个属性追加到<code>person</code>中，但是如果这行是写在<code>module.exports = person</code>之前，就不会有用。<br>因为引用关系发生了变化。<br>因此，在使用的时候，最好统一使用<code>module.exports.xxx = xxx</code>，在引用的时候统一使用<code>const {xxx} = require(&#39;xxx&#39;)</code>，除非是确保只会导出单一方法或者属性时才使用<code>module.exports = xxx</code>和<code>const xxx = require(&#39;xxx)</code></p>
<p>最后，在高版本的node中，已经可以使用es6的Module了，比如<code>export</code>和<code>import</code>。</p>
<h2 id="require"><a href="#require" class="headerlink" title="require"></a>require</h2><p>用来引入第三方模块。</p>
<h2 id="filename"><a href="#filename" class="headerlink" title="filename"></a>filename</h2><p><code>__filename</code>表示当前文件的文件名。</p>
<h2 id="dirname"><a href="#dirname" class="headerlink" title="dirname"></a>dirname</h2><p><code>__dirname</code>当前的文件所在的文件夹名称。</p>
<h2 id="模块缓存"><a href="#模块缓存" class="headerlink" title="模块缓存"></a>模块缓存</h2><p>模块在第一次加载之后会被缓存起来，这意味着同其他缓存机制类似，如果之后每次调用<code>require(xxx)</code>都解析到同一文件，都会返回相同对象。</p>
<p>如<a href="https://github.com/liu-zhuang/node-basic" target="_blank" rel="noopener">demo</a> 所示，在<code>2-require.js</code>中，即使多次使用<code>require(./1-commonjs.js)</code>,但是只执行了一次<code>console.log(a)</code>,这就说明之后每次<code>require</code>都是读的缓存。<br>如果想要每次都执行，则需要把方法通过<code>exports</code>出来，通过手动执行来实现多次调用</p>
<h2 id="循环引用"><a href="#循环引用" class="headerlink" title="循环引用"></a>循环引用</h2><p>当存在循环引用时（即a中引用了b，b中又引用了a），这时，仅将目前执行到的部分引入进来。具体见<a href="https://github.com/liu-zhuang/node-basic/blob/master/4-loop-reference.js" target="_blank" rel="noopener">demo</a></p>
<h1 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h1><p><code>nodejs</code>中常用的全局变量有以下这些：</p>
<ul>
<li>global</li>
<li>Buffer</li>
<li>__dirname</li>
<li>__filename</li>
<li>console</li>
<li>exports</li>
<li>module</li>
<li>process</li>
<li>require</li>
<li>setImmediate、setInterval、setTimeout</li>
<li>clearImmediate、clearInterval、clearTimeout</li>
<li>URL. （v10.0.0新增)</li>
<li>URLSearchParams（v10.0.0新增)</li>
</ul>
<h2 id="global"><a href="#global" class="headerlink" title="global"></a>global</h2><p>和浏览器端的全局变量<code>window</code>类似，<code>nodejs</code>中的全局变量叫<code>global</code>，但是由于在nodejs环境中，一个文件就是一个模块，因此在文件中即使使用<code>var</code>定义一个变量，也不会存在于全局变量中，这时就需要显示的赋值给全局变量了。<br>定义全局变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">global.xyy = &apos;xueyy&apos;;</span><br><span class="line"></span><br><span class="line">const lz = &apos;liuzhuang&apos;;</span><br><span class="line"></span><br><span class="line">module.exports.lz  = lz;</span><br></pre></td></tr></table></figure></p>
<p>使用时：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// require(&apos;./5-glob.js&apos;);</span><br><span class="line"></span><br><span class="line">const &#123;lz&#125; = require(&apos;./5-glob.js&apos;);</span><br><span class="line"></span><br><span class="line">console.log(&apos;lz&apos;, lz);</span><br><span class="line"></span><br><span class="line">console.log(&apos;xyy&apos;, xyy);</span><br><span class="line"></span><br><span class="line">console.log(URL);</span><br></pre></td></tr></table></figure></p>
<p>可以看到，由于把<code>xyy</code>赋值给了全局变量，因此即使没有<code>require</code>,也可以直接使用。<br><a href="https://github.com/liu-zhuang/node-basic/blob/master/5-glob-1.js" target="_blank" rel="noopener">demo</a></p>
<h2 id="Buffer"><a href="#Buffer" class="headerlink" title="Buffer"></a>Buffer</h2><p>在<code>ES6</code>引入<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/TypedArray" target="_blank" rel="noopener">TypedArray</a>之前，javascript没有读取或者操作二进制文件的能力，因此nodejs引入了buffer来在tcp或者操作系统中操作二进制数据流。<br>Buffer类似于整数数组，在创建时分配内存(非V8环境，而是C++)，一旦创建就不能再修改，<br>一些常用方法如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">const b1 = Buffer.alloc(10); // 初始化一个长度为10的buffer实例</span><br><span class="line"></span><br><span class="line">const b2 = Buffer.alloc(10, 1); // 初始化一个长度为10用1填充buffer实例</span><br><span class="line"></span><br><span class="line">const b3 = Buffer.allocUnsafe(10); // 比alloc更快，但是不够安全，可能包含旧数据</span><br><span class="line"></span><br><span class="line">const b4 = Buffer.from(&apos;test&apos;); // 从一个字符串创建一个buffer</span><br><span class="line"></span><br><span class="line">const b41 = Buffer.from(&apos;test&apos;, &apos;base64&apos;); // 从一个字符串创建一个制定编码(base64)的buffer</span><br><span class="line"></span><br><span class="line">const b5 = Buffer.from([1,2,3,4,5]); // 从一个数组创建一个buffer</span><br><span class="line"></span><br><span class="line">const b6 = Buffer.from(b5); // 从一个buffer创建一个buffer</span><br><span class="line"></span><br><span class="line">const bi = Buffer.from(&apos;I &apos;);</span><br><span class="line"></span><br><span class="line">const blove = Buffer.from(&apos;Love &apos;);</span><br><span class="line"></span><br><span class="line">const bu = Buffer.from(&apos;You&apos;);</span><br><span class="line"></span><br><span class="line">const bsymbol = Buffer.from(&apos;!&apos;);</span><br><span class="line"></span><br><span class="line">const bcontact = Buffer.concat([bi, blove, bu, bsymbol]); // buffer 拼接</span><br></pre></td></tr></table></figure></p>
<h2 id="Process"><a href="#Process" class="headerlink" title="Process"></a>Process</h2><p><code>process</code>提供当前Node进程的相关信息，以及控制当前的进程。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">console.log(`process.arch:$&#123;process.arch&#125;`); // 返回当前系统的cpu架构如：X64</span><br><span class="line"></span><br><span class="line">console.log(`process.argv:$&#123;process.argv&#125;`); // 返回启动nodejs进程时的命令后参数 第一个是execPath,(node/bin/),第二个是当前执行的文件路径，后面的是后面接的所有参数</span><br><span class="line"></span><br><span class="line">console.log(`process.argv0:$&#123;process.argv0&#125;`); // 启动的命令 基本都为node 无论是使用node，nodemon,pm2 都一样</span><br><span class="line"></span><br><span class="line">console.log(`process.channel:$&#123;process.channel&#125;`); //如果Node.js进程是由IPC channel(请看 Child Process 文档) 方式创建的，process.channel属性保存IPC channel的引用。 如果IPC channel不存在，此属性值为undefined。</span><br><span class="line"></span><br><span class="line">console.log(`process.chdir:$&#123;process.chdir&#125;`);</span><br><span class="line"></span><br><span class="line">console.log(`process.config:$&#123;JSON.stringify(process.config)&#125;`);</span><br><span class="line"></span><br><span class="line">console.log(`process.cwd:$&#123;process.cwd()&#125;`);</span><br><span class="line"></span><br><span class="line">console.log(`process.debugPort:$&#123;process.debugPort&#125;`);</span><br><span class="line"></span><br><span class="line">console.log(`process.env:$&#123;JSON.stringify(process.env)&#125;`);</span><br></pre></td></tr></table></figure>

  </section>

  
  

<section class="post-comments">

    <div class="ds-thread" data-thread-key="2018/05/12/Node-入门-一/"></div>

    <script type="text/javascript">
      var duoshuoQuery = {short_name:"liuzhuang"};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
        || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
    </script> 

</section>


</article>


            <footer class="footer">
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<script>

(function(){
var bp = document.createElement('script');
var curProtocol = window.location.protocol.split(':')[0];
if (curProtocol === 'https') {
bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
}
else {
bp.src = 'http://push.zhanzhang.baidu.com/push.js';
}
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(bp, s);
})();
</script>
<link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span> Hits
</footer>
        </div>
    </div>

    <!-- js files -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>
    

    

    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            MathJax.Hub.Config({ 
                tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)']]} 
            });
        });
    </script>


    

    <script src="/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    
    
    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

</body>
</html>

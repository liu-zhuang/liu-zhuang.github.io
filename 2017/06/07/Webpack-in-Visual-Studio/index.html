<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      Webpack in Visual Studio | MARVEL 
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="刘荘">
    
    

    <meta name="description" content="前言用webpack来构建纯前端项目已经司空见惯了，但是，其实并没有很多公司真正的实现前后端分离，所以使用asp.net mvc开发还是很普遍的。之前使用.net mvc + vue + elementui 开发感觉得心应手，效率高了很多，但是遇到一个问题：在使用ES6语法时，会遇到兼容性问题。刚开始的时候采用了traceur-compiler来进行实时编译，后来觉得这个总不是best pract">
<meta name="keywords" content="webpack vs visual stuio">
<meta property="og:type" content="article">
<meta property="og:title" content="Webpack in Visual Studio | MARVEL">
<meta property="og:url" content="http://liuz.top/2017/06/07/Webpack-in-Visual-Studio/index.html">
<meta property="og:site_name" content="MARVEL">
<meta property="og:description" content="前言用webpack来构建纯前端项目已经司空见惯了，但是，其实并没有很多公司真正的实现前后端分离，所以使用asp.net mvc开发还是很普遍的。之前使用.net mvc + vue + elementui 开发感觉得心应手，效率高了很多，但是遇到一个问题：在使用ES6语法时，会遇到兼容性问题。刚开始的时候采用了traceur-compiler来进行实时编译，后来觉得这个总不是best pract">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://liuz.top/2017/06/07/Webpack-in-Visual-Studio/webpack%20task%20runner.png">
<meta property="og:image" content="http://liuz.top/2017/06/07/Webpack-in-Visual-Studio/webpack%20task%20runner2.png">
<meta property="og:image" content="http://liuz.top/2017/06/07/Webpack-in-Visual-Studio/webpack%20task%20runner3.png">
<meta property="og:updated_time" content="2018-05-20T15:57:27.631Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Webpack in Visual Studio | MARVEL">
<meta name="twitter:description" content="前言用webpack来构建纯前端项目已经司空见惯了，但是，其实并没有很多公司真正的实现前后端分离，所以使用asp.net mvc开发还是很普遍的。之前使用.net mvc + vue + elementui 开发感觉得心应手，效率高了很多，但是遇到一个问题：在使用ES6语法时，会遇到兼容性问题。刚开始的时候采用了traceur-compiler来进行实时编译，后来觉得这个总不是best pract">
<meta name="twitter:image" content="http://liuz.top/2017/06/07/Webpack-in-Visual-Studio/webpack%20task%20runner.png">
    
    
    
      <link rel="icon" type="image/x-icon" href="/favicon.png">
    
    <link rel="stylesheet" href="/css/uno.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/archive.css">
    <link rel="stylesheet" href="/css/china-social-icon.css">

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">

  
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">MARVEL</a></h1>
        <hr class="panel-cover__divider" />

        
        <p class="panel-cover__description">
          大叔笔记
        </p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="http://liuz.top" title="" class="">主页</a></li>
              
                
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">博客</a></li>
              
                
                <li class="navigation__item"><a href="/about" title="" class="">关于</a></li>
              
                
                <li class="navigation__item"><a href="/archive" title="" class="">归档</a></li>
              

            </ul>
          </nav>

          <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->



<nav class="cover-navigation navigation--social">
  <ul class="navigation">

    
      <!-- Github -->
      <li class="navigation__item">
        <a href="https://github.com/nicky-lau" title="Huno on GitHub">
          <i class='icon icon-social-github'></i>
          <span class="label">GitHub</span>
        </a>
      </li>
    

    <!-- China social icon -->
    <!--
    
      <li class="navigation__item">
        <a href="" title="">
          <i class='icon cs-icon-douban'></i>
          <span class="label">Douban</span>
        </a>
      </li>

      <li class="navigation__item">
        <a href="" title="">
          <i class='icon cs-icon-weibo'></i>
          <span class="label">Weibo</span>
        </a>
      </li>

    -->



  </ul>
</nav>



        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">
    
    <h1 class="post-title">Webpack in Visual Studio</h1>

    

    <div class="post-meta">
      <time datetime="2017-06-07" class="post-meta__date date">2017-06-07</time> 

      <span class="post-meta__tags tags">

          

          
             &#8226; 标签:
            <font class="tags">
              <a class="tags-link" href="/tags/webpack-vs-visual-stuio/">webpack vs visual stuio</a>
            </font>
          

      </span>
    </div>
    
    

  </header>

  <section id="post-content" class="article-content post">
    <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>用webpack来构建纯前端项目已经司空见惯了，但是，其实并没有很多公司真正的实现前后端分离，所以使用asp.net mvc开发还是很普遍的。<br>之前使用.net mvc + vue + elementui 开发感觉得心应手，效率高了很多，但是遇到一个问题：在使用ES6语法时，会遇到兼容性问题。<br>刚开始的时候采用了<code>traceur-compiler</code>来进行实时编译，后来觉得这个总不是best practise，于是开始尝试使用自动构建的方式来实现。</p>
<h1 id="Gulp"><a href="#Gulp" class="headerlink" title="Gulp"></a>Gulp</h1><p>最初的打算是使用Gulp来进行自动构建，但是发现使用Gulp有以下几个问题：</p>
<ol>
<li>需要依赖的库太多</li>
<li>想实现诸如增加基于内容的hash值作为文件名称和实现”livereload”都比较麻烦</li>
</ol>
<h1 id="Webpack"><a href="#Webpack" class="headerlink" title="Webpack"></a>Webpack</h1><p>综合考虑下还是决定直接使用webpack来做：</p>
<ol>
<li>直接可以输出hashchunkname</li>
<li>简单的在命令行加一个<code>-w</code>就可以实现”livereload”</li>
</ol>
<h2 id="基本应用"><a href="#基本应用" class="headerlink" title="基本应用"></a>基本应用</h2><p>引入webpack的最基本目的是为了编译ES6的代码，因此只需要引入<code>babel</code>就可以了。</p>
<ul>
<li>项目文件的根目录执行<code>npm init</code>来初始化<code>package.json</code>文件（一路回车即可)</li>
<li>在当前项目目录下执行<code>npm install --save-dev webpack babel-core babel-loader babel-preset-2015</code>，这样最基础的插件就安装好了</li>
<li>接下来还要安装两个插件，第一个是<code>clean-webpack-plugin</code>，用于清除目录，第二个是<code>assets-webpack-plugin</code>,这个用以生成将js文件和带chunkhash值的文件映射关系的文件，最后还有一个用以装逼的插件<code>webpack-notifier</code>,这个是用来通知webpack执行状态的 (注意：这里如果需要使用<code>babel-polyfill</code>也可以引入)</li>
</ul>
<p>这时没什么好多说的，都是webpack的基本使用，设置entry,module里面设置使用<code>babel-loader</code>来加载”.js”文件<br>同时在执行webpack脚本时增加’-w’参数,就可以实现修改js文件后自动编译了</p>
<h2 id="长效缓存"><a href="#长效缓存" class="headerlink" title="长效缓存"></a>长效缓存</h2><p>为了实现长效缓存，<a href="https://github.com/fouber/blog/issues/6" target="_blank" rel="noopener">戳这里</a>,还需要使用<code>&#39;[name].[chunkhash].js&#39;</code>来给编译后的js名添加hash值，但是这样就产生了很多新的问题</p>
<ul>
<li>因为hash值是根据内容动态变化的，那么开发的时候怎么知道该引用什么名字呢？</li>
<li>同样因为是动态变化的，所以不能把这些文件包含在项目中，因此导致发布的时候，这些文件并不会复制到发布目录<br>解决办法如下：</li>
</ul>
<ol>
<li>使用上面提到的<code>assets-webpack-plugin</code>插件，可以在构建时，生成filename与filename-chunkhash的映射关系。并将这个映射关系保存下来,这样就可以读取这个文件，以类似反射的方式加载</li>
<li>为了这个问题还去研究了一下msbuild，最终通过自己手动复制的方式实现<h2 id="自动反射业务js文件"><a href="#自动反射业务js文件" class="headerlink" title="自动反射业务js文件"></a>自动反射业务js文件</h2>考虑到如果需要每次新增一个js文件，都要去修改webpack.config.js的入口(<code>entry</code>)未免有点麻烦,于是考虑也用类似反射的思路，来读取用来存放业务js代码的文件夹，把每个”.js”都作为入口文件的一个对象:<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> readFile = <span class="function"><span class="keyword">function</span> (<span class="params">path</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line">    <span class="keyword">var</span> files = fs.readdirSync(<span class="string">'./'</span> + path);</span><br><span class="line">    <span class="keyword">var</span> jsFiles = files.filter(<span class="function">(<span class="params">f</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> f.endsWith(<span class="string">'.js'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">var</span> ret = &#123;&#125;;</span><br><span class="line">    jsFiles.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> temp = item.substring(item, item.indexOf(<span class="string">".js"</span>));</span><br><span class="line">        ret[temp] = <span class="string">"./"</span> + SOURCE_DIRECTORY + <span class="string">"/"</span> + item;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>最终生成出来的样子如下所示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// entry: &#123;</span><br><span class="line">//   wp:[ &apos;./app/webpack.js&apos;] // 独立的业务文件</span><br><span class="line">// &#125;, // 入口文件定义</span><br></pre></td></tr></table></figure></p>
<h2 id="举个栗子"><a href="#举个栗子" class="headerlink" title="举个栗子"></a>举个栗子</h2><p>最终的<code>webpack.config.js</code>文件应该长这样：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"><span class="keyword">const</span> AssetsPlugin = <span class="built_in">require</span>(<span class="string">'assets-webpack-plugin'</span>); <span class="comment">// 将每个资源文件的原生filename和chunkhashname一一对应起来的插件</span></span><br><span class="line"><span class="keyword">const</span> CleanPlugin = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>); <span class="comment">// 清空目录的插件</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>); <span class="comment">// 顾名思义，路径相关操作的插件</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>); <span class="comment">// 主角，webpack</span></span><br><span class="line"><span class="keyword">const</span> pkg = <span class="built_in">require</span>(<span class="string">'./package'</span>); <span class="comment">// package.json</span></span><br><span class="line"><span class="keyword">var</span> WebpackNotifierPlugin = <span class="built_in">require</span>(<span class="string">'webpack-notifier'</span>);</span><br><span class="line"><span class="keyword">const</span> SCRIPTS_ROOT = <span class="string">'Content/Scripts/'</span>;</span><br><span class="line"><span class="keyword">const</span> SOURCE_DIRECTORY = <span class="string">'app'</span>; <span class="comment">// 业务文件名</span></span><br><span class="line"><span class="keyword">const</span> BUILD_DIRECTORY = <span class="string">'build'</span>; <span class="comment">// 构建目录名</span></span><br><span class="line"><span class="keyword">const</span> BUILD_DROP_PATH = path.join(__dirname, SCRIPTS_ROOT, BUILD_DIRECTORY);</span><br><span class="line"><span class="comment">//const BUILD_DROP_PATH = path.resolve(__dirname, BUILD_DIRECTORY); // 构建全路径</span></span><br><span class="line"><span class="keyword">const</span> WEB_ROOT = path.join(__dirname, SCRIPTS_ROOT); <span class="comment">// 当前上下文</span></span><br><span class="line"><span class="keyword">const</span> CHUNK_FILE_NAME = <span class="string">'[name].[chunkhash].js'</span>;</span><br><span class="line"><span class="keyword">var</span> readFile = <span class="function"><span class="keyword">function</span> (<span class="params">path</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line">    <span class="keyword">var</span> files = fs.readdirSync(<span class="string">'./'</span> + path);</span><br><span class="line">    <span class="keyword">var</span> jsFiles = files.filter(<span class="function">(<span class="params">f</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> f.endsWith(<span class="string">'.js'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">var</span> ret = &#123;&#125;;</span><br><span class="line">    jsFiles.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> temp = item.substring(item, item.indexOf(<span class="string">".js"</span>));</span><br><span class="line">        ret[temp] = <span class="string">"./"</span> + SOURCE_DIRECTORY + <span class="string">"/"</span> + item;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> webpackEntry = readFile(path.join(SCRIPTS_ROOT, SOURCE_DIRECTORY));</span><br><span class="line"><span class="built_in">console</span>.log(webpackEntry);</span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">    context: WEB_ROOT, <span class="comment">// 声明上下文</span></span><br><span class="line">    <span class="comment">// entry: &#123;</span></span><br><span class="line">    <span class="comment">//   wp:[ './app/webpack.js'] // 独立的业务文件</span></span><br><span class="line">    <span class="comment">// &#125;, // 入口文件定义</span></span><br><span class="line">    entry: webpackEntry,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        loaders: [</span><br><span class="line">        &#123;</span><br><span class="line">            test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">            query: &#123;</span><br><span class="line">                presets: [<span class="string">'es2015'</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            test: <span class="regexp">/(\.css$)/</span>,</span><br><span class="line">            loaders: [<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>, <span class="string">'postcss-loader'</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">       &#123;</span><br><span class="line">           test: <span class="regexp">/\.(png|woff|woff2|eot|ttf|svg)$/</span>,</span><br><span class="line">           loader: <span class="string">'url-loader?limit=100000'</span></span><br><span class="line">       &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;, <span class="comment">// 使用babel编译js</span></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: BUILD_DROP_PATH,</span><br><span class="line">        filename: CHUNK_FILE_NAME,</span><br><span class="line">        chunkFilename: CHUNK_FILE_NAME</span><br><span class="line">    &#125;, <span class="comment">// 输出</span></span><br><span class="line">    plugins: [</span><br><span class="line">    <span class="keyword">new</span> AssetsPlugin(&#123;</span><br><span class="line">        filename: <span class="string">'webpack.assets.json'</span>,</span><br><span class="line">        path: BUILD_DROP_PATH,</span><br><span class="line">        prettyPrint: <span class="literal">true</span></span><br><span class="line">    &#125;), <span class="comment">// 将filename 和 filename.chunkhash对应起来</span></span><br><span class="line">    <span class="keyword">new</span> CleanPlugin(BUILD_DROP_PATH), <span class="comment">// 构建前先清空文件夹</span></span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;</span><br><span class="line">        compress: &#123;</span><br><span class="line">            warnings: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        output: &#123;</span><br><span class="line">            comments: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;), <span class="comment">// 压缩混淆</span></span><br><span class="line">    <span class="keyword">new</span> WebpackNotifierPlugin(), <span class="comment">// 通知结果</span></span><br><span class="line">    ],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">module</span>.exports = config;</span><br></pre></td></tr></table></figure></p>
<p>到目前为止，webpack能做的事就结束了，接下来.net怎么配合呢？</p>
<h2 id="cshtml页面引用"><a href="#cshtml页面引用" class="headerlink" title="cshtml页面引用"></a>cshtml页面引用</h2><p>前面提到了，编译出来的js文件名是含有chunkhash值的，于是最理想的使用方法就是在开发过程中感觉不到变化，还是像之前一样，只需要写”filename”就可以引入含有”chunkhash值”的编译后的js文件。<br>做法如下：<br>首先，扩展一下UrlHelper：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">public static class WebpackExtension</span><br><span class="line">&#123;</span><br><span class="line">    public static string GetResourceUrlHashChunk(this UrlHelper helper, string fileName)</span><br><span class="line">    &#123;</span><br><span class="line">        JObject webpackAssetsJson = null;</span><br><span class="line">        var applicationBasePath = System.AppDomain.CurrentDomain.BaseDirectory;</span><br><span class="line">        string packageJsonFilePath = $&quot;&#123;applicationBasePath&#125;\\&#123;&quot;package.json&quot;&#125;&quot;;</span><br><span class="line">        using (StreamReader packageJsonFile = File.OpenText(packageJsonFilePath))</span><br><span class="line">        &#123;</span><br><span class="line">            using (JsonTextReader packageJsonReader = new JsonTextReader(packageJsonFile))</span><br><span class="line">            &#123;</span><br><span class="line">                JObject packageJson = (JObject)JToken.ReadFrom(packageJsonReader);</span><br><span class="line">                JObject webpackConfigJson = (JObject)packageJson[&quot;customConfig&quot;][&quot;webpackConfig&quot;];</span><br><span class="line">                string webpackAssetsFileName = webpackConfigJson[&quot;assetsFileName&quot;].Value&lt;string&gt;();</span><br><span class="line">                string webpackBuildDirectory = webpackConfigJson[&quot;buildDirectory&quot;].Value&lt;string&gt;();</span><br><span class="line">                string webpackAssetsFilePath = $&quot;&#123;applicationBasePath&#125;\\&#123;webpackBuildDirectory&#125;\\&#123;webpackAssetsFileName&#125;&quot;;</span><br><span class="line">                using (StreamReader webpackAssetsFile = File.OpenText(webpackAssetsFilePath))</span><br><span class="line">                &#123;</span><br><span class="line">                    using (JsonTextReader webpackAssetsReader = new JsonTextReader(webpackAssetsFile))</span><br><span class="line">                    &#123;</span><br><span class="line">                        webpackAssetsJson = (JObject)JToken.ReadFrom(webpackAssetsReader);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                return &quot;~/&quot; + webpackBuildDirectory + webpackAssetsJson.SelectToken(fileName).Value&lt;string&gt;(&quot;js&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这段代码做的事情就是把<code>AssetsPlugin</code>这个插件生成的包含映射关系的文件读出来，然后根据文件名找到真实路径<br>于是在前台(cshtml)页面中使用时，可以直接使用以下方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;@Url.Content(@Url.GetResourceUrlHashChunk(&quot;webpack&quot;))&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure></p>
<p> 注：webpack是我这个js的名称</p>
<h2 id="发布问题"><a href="#发布问题" class="headerlink" title="发布问题"></a>发布问题</h2><p> 事情到这里还没有结束，在发布时又发生了状况，那就是这些编译后的文件由于是动态生成的，无法包入项目文件，因此也就不会复制的发布目录中，解决方法如下：<br> 在项目根目录下的<code>Properties\PublishProfiles</code>文件夹中，会保存发布的配置文件，由于visual studio是使用MSBuild进行编译发布的，因此在对MSbuild略加研究之后，<code>pubxml</code>的内容如下：<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!--</span><br><span class="line">您 Web 项目的发布/打包进程将使用此文件。您可以通过编辑此 MSBuild 文件</span><br><span class="line">来自定义该进程的行为。若要了解与此相关的详细信息，请访问 http://go.microsoft.com/fwlink/?LinkID=208121。</span><br><span class="line">--&gt;</span><br><span class="line">&lt;Project ToolsVersion=&quot;4.0&quot; xmlns=&quot;http://schemas.microsoft.com/developer/msbuild/2003&quot;&gt;</span><br><span class="line">  &lt;PropertyGroup&gt;</span><br><span class="line">    &lt;WebPublishMethod&gt;FileSystem&lt;/WebPublishMethod&gt;</span><br><span class="line">    &lt;LastUsedBuildConfiguration&gt;Release&lt;/LastUsedBuildConfiguration&gt;</span><br><span class="line">    &lt;LastUsedPlatform&gt;Any CPU&lt;/LastUsedPlatform&gt;</span><br><span class="line">    &lt;SiteUrlToLaunchAfterPublish /&gt;</span><br><span class="line">    &lt;LaunchSiteAfterPublish&gt;True&lt;/LaunchSiteAfterPublish&gt;</span><br><span class="line">    &lt;ExcludeApp_Data&gt;False&lt;/ExcludeApp_Data&gt;</span><br><span class="line">    &lt;publishUrl&gt;F:\WebDemo\webpack&lt;/publishUrl&gt;</span><br><span class="line">    &lt;jsPublishUrl&gt;F:\WebDemo\webpack\Content\Scripts\build&lt;/jsPublishUrl&gt;</span><br><span class="line">    &lt;!--这里务必设为false--&gt;</span><br><span class="line">    &lt;DeleteExistingFiles&gt;False&lt;/DeleteExistingFiles&gt;</span><br><span class="line">    &lt;PrecompileBeforePublish&gt;True&lt;/PrecompileBeforePublish&gt;</span><br><span class="line">    &lt;EnableUpdateable&gt;True&lt;/EnableUpdateable&gt;</span><br><span class="line">    &lt;DebugSymbols&gt;False&lt;/DebugSymbols&gt;</span><br><span class="line">    &lt;WDPMergeOption&gt;DonotMerge&lt;/WDPMergeOption&gt;</span><br><span class="line">  &lt;/PropertyGroup&gt;</span><br><span class="line">  &lt;ItemGroup&gt;</span><br><span class="line">    &lt;!--定义需要copy到发布目录的文件</span><br><span class="line">    定义发布前需要先删除的文件夹--&gt;</span><br><span class="line">    &lt;WebFiles Include=&quot;$(ProjectDir)\Content\Scripts\build\*.*&quot; /&gt;</span><br><span class="line">    &lt;OutputFiles Include=&quot;$(publishUrl)\**\*.*&quot; /&gt;</span><br><span class="line">  &lt;/ItemGroup&gt;</span><br><span class="line">  &lt;!--先删除之前老的发布文件--&gt;</span><br><span class="line">  &lt;Target Name=&quot;RemoveDirectories&quot; AfterTargets=&quot;AfterBuild&quot;&gt;</span><br><span class="line">    &lt;Delete Files=&quot;@(OutputFiles)&quot; /&gt;</span><br><span class="line">  &lt;/Target&gt;</span><br><span class="line">  &lt;!--将带hashchunk的压缩过的js文件copy到发布目录--&gt;</span><br><span class="line">  &lt;Target Name=&quot;moveChunkhashJs&quot; AfterTargets=&quot;RemoveDirectories&quot;&gt;</span><br><span class="line">    &lt;MakeDir Directories=&quot;$(jsPublishUrl)&quot; Condition=&quot;!Exists(&apos;$(jsPublishUrl)&apos;)&quot; /&gt;</span><br><span class="line">    &lt;Copy SourceFiles=&quot;@(WebFiles)&quot; DestinationFolder=&quot;$(jsPublishUrl)&quot;&gt;</span><br><span class="line">    &lt;/Copy&gt;</span><br><span class="line">  &lt;/Target&gt;</span><br><span class="line">&lt;/Project&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="vs2015-webpack-task-runner-插件"><a href="#vs2015-webpack-task-runner-插件" class="headerlink" title="vs2015 webpack task runner 插件"></a>vs2015 webpack task runner 插件</h2><p> 在vs2015里还可以直接安装webpack task runner 插件来使用<br> 如图所示，还可以将webpack脚本和生成事件绑定起来了。<br> 最后还有一个小坑：<a href="https://github.com/madskristensen/NpmTaskRunner/issues/47" target="_blank" rel="noopener">戳这里</a><br> 如果你在命令行运行脚本没问题，但是使用webpack task runner 出了问题，很有可能就是这个原因，配置”外部Web公交”时，的位置顺序不对。<br> <img src="/2017/06/07/Webpack-in-Visual-Studio/webpack task runner.png" alt="plugin1"><br> <img src="/2017/06/07/Webpack-in-Visual-Studio/webpack task runner2.png" alt="plugin2"><br> <img src="/2017/06/07/Webpack-in-Visual-Studio/webpack task runner3.png" alt="plugin3"></p>
<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p> 其实还有很多可以优化的地方，比如第三方库，css等，但是目前已经可以满足初步需求了。接下来再做进一步的优化。</p>
<h1 id="栗子"><a href="#栗子" class="headerlink" title="栗子"></a>栗子</h1><p> <a href="https://github.com/liu-zhuang/webpack-vs/" target="_blank" rel="noopener">栗子</a></p>

  </section>

  
  

<section class="post-comments">

    <div class="ds-thread" data-thread-key="2017/06/07/Webpack-in-Visual-Studio/"></div>

    <script type="text/javascript">
      var duoshuoQuery = {short_name:"liuzhuang"};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
        || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
    </script> 

</section>


</article>


            <footer class="footer">
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<script>

(function(){
var bp = document.createElement('script');
var curProtocol = window.location.protocol.split(':')[0];
if (curProtocol === 'https') {
bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
}
else {
bp.src = 'http://push.zhanzhang.baidu.com/push.js';
}
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(bp, s);
})();
</script>
<link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span> Hits
</footer>
        </div>
    </div>

    <!-- js files -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>
    

    

    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            MathJax.Hub.Config({ 
                tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)']]} 
            });
        });
    </script>


    

    <script src="/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    
    
    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

</body>
</html>
